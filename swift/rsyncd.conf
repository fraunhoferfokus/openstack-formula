uid = {{ salt['pillar.get']('swift:user','swift') }}
gid = {{ salt['pillar.get']('swift:group','swift') }}
log file = /var/log/rsyncd.log
pid file = /var/run/rsyncd.pid
address = {{ salt['pillar.get']('swift:IPs:storage_local') }}

[account]
max connections = 2
path = /srv/node/
read only = false
lock file = /var/lock/account.lock

[container]
max connections = 2
path = /srv/node/
read only = false
lock file = /var/lock/container.lock

[object]
max connections = 2
path = /srv/node/
read only = false
lock file = /var/lock/object.lock 

{% for zone in salt['pillar.get']('swift:devices').keys() %}
  {% for builder, base_port in salt['pillar.get']('swift:builder_ports',{'account.builder':6002,'container.builder':6001,'object.builder':6000}).iteritems() %}
    {% set port = base_port + zone * 10 %}
[{{builder.split('.')[0]}}{{port}}]
max connections = 25
path = /srv/node/{{zone}}
read only = false
lock file = /var/lock/{{builder.split('.')[0]}}{{port}}.lock
  {% endfor %}
{% endfor %}
